<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente con gesti√≥n de tareas</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">U</div>
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">Kevinlr</div>
                        <div style="font-size: 12px; color: #888;">Gestor de tareas con IA</div>
                    </div>
                </div>

                <div class="search-box" style="position: relative; margin-top: 16px;">
                    <input type="text" class="search-input" placeholder="Buscar tareas..." id="searchInput" style="width: 100%; padding: 8px 12px 8px 36px; border: 1px solid #e1e1e1; border-radius: 6px; font-size: 14px; background-color: #f8f8f8;">
                    <div class="search-icon" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #888;">üîç</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-item active" data-view="today" onclick="switchView('today')">
                        <div class="nav-item-icon">üìÖ</div>
                        <div class="nav-item-text">Hoy</div>
                        <div class="nav-item-count" id="todayCount">0</div>
                    </div>
                    <div class="nav-item" data-view="upcoming" onclick="switchView('upcoming')">
                        <div class="nav-item-icon">üìÜ</div>
                        <div class="nav-item-text">Pr√≥ximamente</div>
                        <div class="nav-item-count" id="upcomingCount">0</div>
                    </div>
                    <div class="nav-item" data-view="inbox" onclick="switchView('inbox')">
                        <div class="nav-item-icon">üì•</div>
                        <div class="nav-item-text">Bandeja de entrada</div>
                        <div class="nav-item-count" id="inboxCount">0</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Favoritos</div>
                    <div class="nav-item" data-view="important" onclick="switchView('important')">
                        <div class="nav-item-icon">‚≠ê</div>
                        <div class="nav-item-text">Importante</div>
                        <div class="nav-item-count" id="importantCount">0</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Proyectos</div>
                    <div id="projectsList">
                        <!-- Los proyectos se cargar√°n din√°micamente -->
                    </div>
                    <div class="nav-item" onclick="showProjectModal()">
                        <div class="nav-item-icon">‚ûï</div>
                        <div class="nav-item-text">A√±adir proyecto</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Filtros</div>
                    <div class="nav-item" data-view="all" onclick="switchView('all')">
                        <div class="nav-item-icon">üìã</div>
                        <div class="nav-item-text">Todas las tareas</div>
                        <div class="nav-item-count" id="allCount">0</div>
                    </div>
                    <div class="nav-item" data-view="completed" onclick="switchView('completed')">
                        <div class="nav-item-icon">‚úÖ</div>
                        <div class="nav-item-text">Completadas</div>
                        <div class="nav-item-count" id="completedCount">0</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Etiquetas</div>
                    <div id="labelsList">
                        <!-- Las etiquetas se cargar√°n din√°micamente -->
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">IA Settings</div>
                    <div class="nav-item" onclick="showAIConfigModal()">
                        <div class="nav-item-icon">‚öôÔ∏è</div>
                        <div class="nav-item-text">Configurar IA</div>
                    </div>
                    <div class="nav-item" onclick="showAIStatsModal()">
                        <div class="nav-item-icon">üìä</div>
                        <div class="nav-item-text">Estad√≠sticas</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Gesti√≥n de Datos</div>
                    <div class="nav-item" onclick="showDataManagementModal()">
                        <div class="nav-item-icon">üíæ</div>
                        <div class="nav-item-text">Importar/Exportar</div>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="main-header">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <h1 class="main-title" id="mainTitle">Hoy</h1>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="toggleTaskForm()" id="toggleFormBtn">
                        <span>üìù</span>
                        Mostrar formulario
                    </button>
                    <button class="header-btn" onclick="showTaskModal()">
                        <span>‚ûï</span>
                        A√±adir tarea
                    </button>
                </div>
            </header>

            <div class="tasks-container">
                <div class="task-form" id="taskForm" style="display: none;">
                    <div class="task-form-header">
                        <h3 style="margin: 0; color: #202124; font-size: 18px;">Nueva tarea</h3>
                        <button class="close-form-btn" onclick="toggleTaskForm()">√ó</button>
                    </div>
                    <form id="task-form">
                        <div class="form-row">
                            <input type="text" id="task-name" placeholder="Nombre de la tarea" required />
                            <select id="task-priority">
                                <option value="baja">Prioridad baja</option>
                                <option value="media">Prioridad media</option>
                                <option value="alta">Prioridad alta</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <textarea id="task-description" placeholder="Descripci√≥n (opcional)"></textarea>
                        </div>
                        <div class="form-row">
                            <select id="task-project">
                                <option value="">Sin proyecto</option>
                            </select>
                            <input type="datetime-local" id="task-date" />
                        </div>
                        <div class="form-row">
                            <div class="tags-input-container">
                                <input type="text" id="task-tags" placeholder="Etiquetas (presiona Enter para agregar)" />
                                <div class="tags-suggestions" id="tagsSuggestions"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <input type="text" id="task-subtasks" placeholder="Subtareas (presiona Enter para agregar)" />
                        </div>
                        <div id="selected-tags" style="margin-bottom: 12px;"></div>
                        <div id="selected-subtasks" style="margin-bottom: 12px;"></div>
                        <button type="submit" class="add-btn">A√±adir tarea</button>
                    </form>
                </div>

                <div class="tasks-list" id="tasksList">
                    <!-- Las tareas se cargar√°n din√°micamente -->
                </div>

                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">üìã</div>
                    <div class="empty-title">Sin tareas</div>
                    <div class="empty-description">¬°A√±ade tu primera tarea para comenzar!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar tareas -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Detalles de la tarea</h2>
                <button class="modal-close" onclick="hideTaskModal()">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">T√≠tulo</label>
                <input type="text" class="form-input" id="modalTaskTitle" placeholder="Nombre de la tarea">
            </div>
            <div class="form-group">
                <label class="form-label">Descripci√≥n</label>
                <textarea class="form-input form-textarea" id="modalTaskDescription" placeholder="Descripci√≥n de la tarea"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Proyecto</label>
                <select class="form-select" id="modalTaskProject">
                    <option value="">Sin proyecto</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Fecha l√≠mite</label>
                <input type="datetime-local" class="form-input" id="modalTaskDate">
            </div>
            <div class="form-group">
                <label class="form-label">Prioridad</label>
                <select class="form-select" id="modalTaskPriority">
                    <option value="alta">Prioridad alta</option>
                    <option value="media">Prioridad media</option>
                    <option value="baja" selected>Prioridad baja</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Etiquetas</label>
                <div class="tags-input-container">
                    <input type="text" class="form-input" id="modalTaskLabels" placeholder="A√±adir etiqueta y presionar Enter">
                    <div class="tags-suggestions" id="modalTagsSuggestions"></div>
                </div>
                <div class="selected-labels" id="selectedLabels"></div>
            </div>
            <div class="form-group">
                <label class="form-label">Subtareas</label>
                <div class="subtasks-editor">
                    <div class="subtasks-list" id="modalSubtasksList"></div>
                    <input type="text" class="form-input" id="newSubtaskInput" placeholder="A√±adir subtarea y presionar Enter">
                </div>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" onclick="saveTask()" style="width: 100%;">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para proyectos -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="projectModalTitle">Nuevo proyecto</h2>
                <button class="modal-close" onclick="hideProjectModal()">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Nombre del proyecto</label>
                <input type="text" class="form-input" id="projectNameInput" placeholder="Mi proyecto">
            </div>
            <div class="form-group">
                <label class="form-label">Color</label>
                <select class="form-select" id="projectColorInput">
                    <option value="#db4035">üî¥ Rojo</option>
                    <option value="#ff9933">üü† Naranja</option>
                    <option value="#fad000">üü° Amarillo</option>
                    <option value="#299438">üü¢ Verde</option>
                    <option value="#6accbc">üîµ Azul claro</option>
                    <option value="#158fad">üî∑ Azul</option>
                    <option value="#14aaf5">üíô Azul cielo</option>
                    <option value="#96c3eb">ü©µ Azul pastel</option>
                    <option value="#884dff">üü£ Morado</option>
                    <option value="#af38eb">üü™ Rosa</option>
                </select>
            </div>
            <div class="form-group" style="display: flex; gap: 12px;">
                <button class="btn btn-primary" onclick="saveProject()" style="flex: 1;">Guardar</button>
                <button class="btn btn-danger" id="deleteProjectBtn" onclick="deleteProject()" style="display: none;">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Configuraci√≥n de IA -->
    <div class="modal" id="aiConfigModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Configuraci√≥n de IA</h2>
                <button class="modal-close" onclick="hideAIConfigModal()">√ó</button>
            </div>

            <div class="warning-box" id="costWarning" style="display: none;">
                <h4>‚ö†Ô∏è Advertencia de Costos</h4>
                <p>El modelo GPT-4 es considerablemente m√°s caro. Se recomienda usar GPT-3.5-turbo para reducir costos en un 90%.</p>
            </div>

            <div class="config-grid">
                <div class="config-item full-width">
                    <label class="form-label">üîë API Key de OpenAI</label>
                    <input type="password" class="form-input" id="aiApiKey" placeholder="sk-..." value="">
                    <small style="color: #666; font-size: 12px;">Tu API key se guarda localmente y nunca se comparte</small>
                </div>

                <div class="config-item">
                    <label class="form-label">ü§ñ Modelo de IA</label>
                    <select class="form-select" id="aiModel">
                        <option value="gpt-4.1-nano">GPT-4.1 nano (Recomendado)</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Econ√≥mico)</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo (Balanceado)</option>
                        <option value="gpt-4">GPT-4 (M√°s caro)</option>
                    </select>
                </div>

                <div class="config-item">
                    <label class="form-label">üìè M√°x. tokens respuesta</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="maxTokens" min="100" max="4000" value="1000" step="100">
                        <div class="slider-value" id="maxTokensValue">1000</div>
                    </div>
                </div>

                <div class="config-item">
                    <label class="form-label">üéØ Temperatura (creatividad)</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="temperature" min="0" max="2" value="0.7" step="0.1">
                        <div class="slider-value" id="temperatureValue">0.7</div>
                    </div>
                </div>

                <div class="config-item">
                    <label class="form-label">üí≠ L√≠mite historial mensajes</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="historyLimit" min="5" max="50" value="10" step="5">
                        <div class="slider-value" id="historyLimitValue">10</div>
                    </div>
                </div>

                <div class="config-item full-width">
                    <div class="cost-indicator">
                        <h4>üí∞ Costo estimado por consulta</h4>
                        <div class="cost-value" id="costEstimate">~$0.01</div>
                    </div>
                </div>
            </div>

            <div class="form-group" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveAIConfig()" style="width: 100%;">Guardar Configuraci√≥n</button>
            </div>
        </div>
    </div>

    <!-- Modal de Estad√≠sticas de IA -->
    <div class="modal" id="aiStatsModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">üìä Estad√≠sticas de Uso de IA</h2>
                <button class="modal-close" onclick="hideAIStatsModal()">√ó</button>
            </div>

            <div class="stats-grid">
                <div class="stats-card">
                    <h4>Consultas Hoy</h4>
                    <div class="stats-value" id="todayQueries">0</div>
                </div>
                <div class="stats-card">
                    <h4>Tokens Usados</h4>
                    <div class="stats-value" id="tokensUsed">0</div>
                </div>
                <div class="stats-card">
                    <h4>Costo Estimado</h4>
                    <div class="stats-value" id="estimatedCost">$0.00</div>
                </div>
                <div class="stats-card">
                    <h4>Modelo Actual</h4>
                    <div class="stats-value" id="currentModel">GPT-4.1 nano</div>
                </div>
            </div>

            <div class="form-group">
                <h3 style="margin-bottom: 12px;">üìà Historial de Uso</h3>
                <div style="background: #f8f9fa; border-radius: 6px; padding: 16px; max-height: 200px; overflow-y: auto;">
                    <div id="usageHistory">
                        <!-- El historial se cargar√° din√°micamente -->
                    </div>
                </div>
            </div>

            <div class="form-group" style="display: flex; gap: 12px;">
                <button class="btn btn-secondary" onclick="exportStats()" style="flex: 1;">üì§ Exportar</button>
                <button class="btn btn-secondary" onclick="clearStats()" style="flex: 1;">üóëÔ∏è Limpiar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Gesti√≥n de Datos -->
    <div class="modal" id="dataManagementModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">üíæ Gesti√≥n de Datos</h2>
                <button class="modal-close" onclick="hideDataManagementModal()">√ó</button>
            </div>

            <div class="form-group">
                <h3 style="margin-bottom: 12px;">üì§ Exportar Datos</h3>
                <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
                    Exporta todas tus tareas, proyectos y configuraci√≥n para hacer respaldo o transferir a otro dispositivo.
                </p>
                <div class="data-actions">
                    <button class="btn btn-primary" onclick="exportAllData()">
                        üì§ Exportar Todo
                    </button>
                    <button class="btn btn-secondary" onclick="exportTasks()">
                        üìã Solo Tareas
                    </button>
                    <button class="btn btn-secondary" onclick="exportProjects()">
                        üìÅ Solo Proyectos
                    </button>
                </div>
            </div>

            <div class="form-group">
                <h3 style="margin-bottom: 12px;">üì• Importar Datos</h3>
                <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
                    Importa datos previamente exportados. <strong>Advertencia:</strong> Esto reemplazar√° todos los datos actuales.
                </p>
                <input type="file" id="importFileInput" accept=".json" style="margin-bottom: 16px;" />
                <div class="data-actions">
                    <button class="btn btn-primary" onclick="importData()">
                        üì• Importar Datos
                    </button>
                    <button class="btn btn-danger" onclick="clearAllData()">
                        üóëÔ∏è Limpiar Todo
                    </button>
                </div>
            </div>

            <div class="warning-box">
                <h4>‚ö†Ô∏è Importante</h4>
                <p>Siempre haz una copia de seguridad antes de importar datos o limpiar. Los datos eliminados no se pueden recuperar.</p>
            </div>
        </div>
    </div>

    <!-- Chat del asistente -->
    <div id="chat-container">
        <div class="chat-header">
            ü§ñ Asistente de Tareas
            <button class="chat-minimize-btn" onclick="toggleChat()" id="chatMinimizeBtn">‚àí</button>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="chat-input" placeholder="Escribe tu mensaje..." onkeypress="if(event.key==='Enter') enviarMensaje()">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="script.js"></script>
</body>
</html>