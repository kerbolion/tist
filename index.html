<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todoist Clone - Gesti√≥n de Tareas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #fafafa;
            color: #202020;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background-color: #fff;
            border-right: 1px solid #e1e1e1;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .search-box {
            position: relative;
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid #e1e1e1;
            border-radius: 6px;
            font-size: 14px;
            background-color: #f8f8f8;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }

        .add-task-btn {
            width: 100%;
            padding: 8px 12px;
            background-color: #db4035;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .add-task-btn:hover {
            background-color: #c23616;
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            padding: 0 20px 8px;
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 8px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .nav-item:hover {
            background-color: #f8f8f8;
        }

        .nav-item.active {
            background-color: #f3f3f3;
            border-right: 3px solid #db4035;
        }

        .nav-item-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            color: #666;
        }

        .nav-item-text {
            flex: 1;
            font-size: 14px;
        }

        .nav-item-count {
            background-color: #e1e1e1;
            color: #666;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 12px;
            min-width: 20px;
            text-align: center;
        }

        .project-item {
            position: relative;
        }

        .project-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 12px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .main-header {
            background-color: #fff;
            padding: 20px 30px;
            border-bottom: 1px solid #e1e1e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .main-title {
            font-size: 24px;
            font-weight: 700;
            color: #202020;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            padding: 8px 12px;
            border: 1px solid #e1e1e1;
            background-color: #fff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .header-btn:hover {
            background-color: #f8f8f8;
        }

        .tasks-container {
            flex: 1;
            padding: 20px 30px;
            overflow-y: auto;
        }

        .task-input-container {
            margin-bottom: 24px;
        }

        .quick-add {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            background-color: #fff;
            cursor: text;
            transition: all 0.2s;
        }

        .quick-add:hover, .quick-add.active {
            border-color: #db4035;
            box-shadow: 0 0 0 3px rgba(219, 64, 53, 0.1);
        }

        .quick-add-icon {
            color: #db4035;
            width: 20px;
            height: 20px;
        }

        .quick-add-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 14px;
            color: #888;
            background: transparent;
        }

        .quick-add-input.has-text {
            color: #202020;
        }

        .task-form {
            display: none;
            background-color: #fff;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-form.active {
            display: block;
        }

        .task-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e1e1e1;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 12px;
            resize: vertical;
            min-height: 44px;
        }

        .task-options {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .option-btn {
            padding: 6px 12px;
            border: 1px solid #e1e1e1;
            background-color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background-color: #f8f8f8;
        }

        .option-btn.active {
            border-color: #db4035;
            background-color: #fef2f2;
            color: #db4035;
        }

        .task-actions {
            display: flex;
            justify-content: space-between;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #db4035;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #c23616;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: #f8f8f8;
            color: #666;
        }

        .btn-secondary:hover {
            background-color: #e1e1e1;
        }

        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .task-item {
            background-color: #fff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .task-item:hover {
            border-color: #d0d0d0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .task-item.completed {
            opacity: 0.6;
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 8px;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #e1e1e1;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .task-checkbox:hover {
            border-color: #db4035;
        }

        .task-checkbox.completed {
            background-color: #db4035;
            border-color: #db4035;
            color: white;
        }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-size: 14px;
            font-weight: 500;
            color: #202020;
            margin-bottom: 4px;
            word-wrap: break-word;
        }

        .task-title.completed {
            text-decoration: line-through;
            color: #888;
        }

        .task-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .task-project {
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-due-date {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .due-today {
            background-color: #fef2f2;
            color: #dc2626;
        }

        .due-overdue {
            background-color: #fef2f2;
            color: #dc2626;
            font-weight: 600;
        }

        .due-future {
            background-color: #f0f9ff;
            color: #0369a1;
        }

        .task-labels {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .task-label {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 3px;
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .task-priority {
            display: flex;
            align-items: center;
        }

        .priority-flag {
            width: 14px;
            height: 14px;
        }

        .priority-1 { color: #dc2626; }
        .priority-2 { color: #ea580c; }
        .priority-3 { color: #ca8a04; }
        .priority-4 { color: #6b7280; }

        .task-actions-menu {
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .task-item:hover .task-actions-menu {
            opacity: 1;
        }

        .action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background-color: #f3f4f6;
            color: #374151;
        }

        .subtasks {
            margin-left: 32px;
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
        }

        .subtask-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid #e1e1e1;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .subtask-checkbox.completed {
            background-color: #db4035;
            border-color: #db4035;
            color: white;
        }

        .subtask-title {
            font-size: 13px;
            color: #374151;
        }

        .subtask-title.completed {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-description {
            font-size: 14px;
            color: #aaa;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        .modal-close:hover {
            background-color: #f3f4f6;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e1e1e1;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e1e1e1;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                z-index: 100;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                width: 100%;
            }

            .tasks-container {
                padding: 20px 16px;
            }

            .main-header {
                padding: 16px 20px;
            }
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .task-item {
            animation: fadeIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .nav-item {
            animation: slideIn 0.2s ease;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">U</div>
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">Usuario</div>
                        <div style="font-size: 12px; color: #888;">Free plan</div>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Buscar" id="searchInput">
                    <div class="search-icon">üîç</div>
                </div>

                <button class="add-task-btn" onclick="showQuickAdd()">
                    <span>‚ûï</span>
                    A√±adir tarea
                </button>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-item active" data-view="today" onclick="switchView('today')">
                        <div class="nav-item-icon">üìÖ</div>
                        <div class="nav-item-text">Hoy</div>
                        <div class="nav-item-count" id="todayCount">0</div>
                    </div>
                    <div class="nav-item" data-view="upcoming" onclick="switchView('upcoming')">
                        <div class="nav-item-icon">üìÜ</div>
                        <div class="nav-item-text">Pr√≥ximamente</div>
                        <div class="nav-item-count" id="upcomingCount">0</div>
                    </div>
                    <div class="nav-item" data-view="inbox" onclick="switchView('inbox')">
                        <div class="nav-item-icon">üì•</div>
                        <div class="nav-item-text">Bandeja de entrada</div>
                        <div class="nav-item-count" id="inboxCount">0</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Favoritos</div>
                    <div class="nav-item" data-view="important" onclick="switchView('important')">
                        <div class="nav-item-icon">‚≠ê</div>
                        <div class="nav-item-text">Importante</div>
                        <div class="nav-item-count" id="importantCount">0</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Proyectos</div>
                    <div id="projectsList">
                        <!-- Los proyectos se cargar√°n din√°micamente -->
                    </div>
                    <div class="nav-item" onclick="showProjectModal()">
                        <div class="nav-item-icon">‚ûï</div>
                        <div class="nav-item-text">A√±adir proyecto</div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Etiquetas</div>
                    <div id="labelsList">
                        <!-- Las etiquetas se cargar√°n din√°micamente -->
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Filtros</div>
                    <div class="nav-item" data-view="assigned" onclick="switchView('assigned')">
                        <div class="nav-item-icon">üë§</div>
                        <div class="nav-item-text">Asignadas a m√≠</div>
                        <div class="nav-item-count" id="assignedCount">0</div>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="main-header">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <h1 class="main-title" id="mainTitle">Hoy</h1>
                </div>
                <div class="header-actions">
                    <button class="header-btn">
                        <span>üëÅÔ∏è</span>
                        Ver
                    </button>
                    <button class="header-btn" onclick="showTaskModal()">
                        <span>‚ûï</span>
                        A√±adir tarea
                    </button>
                </div>
            </header>

            <div class="tasks-container">
                <div class="task-input-container">
                    <div class="quick-add" onclick="showQuickAdd()" id="quickAdd">
                        <div class="quick-add-icon">‚ûï</div>
                        <input type="text" class="quick-add-input" placeholder="A√±adir tarea" id="quickAddInput">
                    </div>

                    <div class="task-form" id="taskForm">
                        <input type="text" class="task-input" placeholder="Nombre de la tarea" id="taskTitleInput">
                        <textarea class="task-input" placeholder="Descripci√≥n" id="taskDescriptionInput" rows="2"></textarea>
                        
                        <div class="task-options">
                            <button class="option-btn" onclick="toggleDatePicker()">
                                <span>üìÖ</span>
                                <span id="dueDateText">Fecha l√≠mite</span>
                            </button>
                            <button class="option-btn" onclick="toggleProjectPicker()">
                                <span>üìÅ</span>
                                <span id="projectText">Proyecto</span>
                            </button>
                            <button class="option-btn" onclick="togglePriorityPicker()">
                                <span>üèÉ</span>
                                <span id="priorityText">Prioridad</span>
                            </button>
                            <button class="option-btn" onclick="toggleLabelPicker()">
                                <span>üè∑Ô∏è</span>
                                <span>Etiquetas</span>
                            </button>
                        </div>

                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="hideTaskForm()">Cancelar</button>
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="addTask()" id="addTaskBtn">A√±adir tarea</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tasks-list" id="tasksList">
                    <!-- Las tareas se cargar√°n din√°micamente -->
                </div>

                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">üìã</div>
                    <div class="empty-title">Sin tareas</div>
                    <div class="empty-description">¬°Has completado todas tus tareas!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para tareas detalladas -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Detalles de la tarea</h2>
                <button class="modal-close" onclick="hideTaskModal()">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">T√≠tulo</label>
                <input type="text" class="form-input" id="modalTaskTitle" placeholder="Nombre de la tarea">
            </div>
            <div class="form-group">
                <label class="form-label">Descripci√≥n</label>
                <textarea class="form-input form-textarea" id="modalTaskDescription" placeholder="Descripci√≥n de la tarea"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Proyecto</label>
                <select class="form-select" id="modalTaskProject">
                    <option value="">Sin proyecto</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Fecha l√≠mite</label>
                <input type="date" class="form-input" id="modalTaskDate">
            </div>
            <div class="form-group">
                <label class="form-label">Prioridad</label>
                <select class="form-select" id="modalTaskPriority">
                    <option value="1">Prioridad 1 üî¥</option>
                    <option value="2">Prioridad 2 üü†</option>
                    <option value="3">Prioridad 3 üü°</option>
                    <option value="4" selected>Prioridad 4 ‚ö™</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Etiquetas</label>
                <div class="labels-input-container">
                    <input type="text" class="form-input" id="modalTaskLabels" placeholder="A√±adir etiqueta y presionar Enter" onkeypress="handleLabelInput(event)">
                    <div class="selected-labels" id="selectedLabels" style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: wrap;">
                        <!-- Las etiquetas seleccionadas aparecer√°n aqu√≠ -->
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Subtareas</label>
                <div class="subtasks-editor">
                    <div class="subtasks-list" id="modalSubtasksList">
                        <!-- Las subtareas aparecer√°n aqu√≠ -->
                    </div>
                    <div class="add-subtask-container">
                        <input type="text" class="form-input" id="newSubtaskInput" placeholder="A√±adir subtarea y presionar Enter" onkeypress="handleSubtaskInput(event)">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" onclick="saveTask()" style="width: 100%;">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para proyectos -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nuevo proyecto</h2>
                <button class="modal-close" onclick="hideProjectModal()">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Nombre del proyecto</label>
                <input type="text" class="form-input" id="projectNameInput" placeholder="Mi proyecto">
            </div>
            <div class="form-group">
                <label class="form-label">Color</label>
                <select class="form-select" id="projectColorInput">
                    <option value="#db4035">üî¥ Rojo</option>
                    <option value="#ff9933">üü† Naranja</option>
                    <option value="#fad000">üü° Amarillo</option>
                    <option value="#299438">üü¢ Verde</option>
                    <option value="#6accbc">üîµ Azul claro</option>
                    <option value="#158fad">üî∑ Azul</option>
                    <option value="#14aaf5">üíô Azul cielo</option>
                    <option value="#96c3eb">ü©µ Azul pastel</option>
                    <option value="#884dff">üü£ Morado</option>
                    <option value="#af38eb">üü™ Rosa</option>
                </select>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" onclick="addProject()" style="width: 100%;">Crear proyecto</button>
            </div>
        </div>
    </div>

    <script>
        // Datos de la aplicaci√≥n
        let appData = {
            tasks: [],
            projects: [
                { id: 1, name: 'Trabajo', color: '#db4035', taskCount: 0 },
                { id: 2, name: 'Personal', color: '#ff9933', taskCount: 0 },
                { id: 3, name: 'Estudio', color: '#299438', taskCount: 0 }
            ],
            labels: [
                { id: 1, name: 'urgente', color: '#db4035' },
                { id: 2, name: 'importante', color: '#ff9933' },
                { id: 3, name: 'reunion', color: '#299438' }
            ],
            currentView: 'today',
            editingTask: null,
            currentTask: {}
        };

        // Variables globales
        let taskIdCounter = 1;
        let projectIdCounter = 4;
        let labelIdCounter = 4;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderProjects();
            renderLabels();
            renderTasks();
            updateCounts();
            
            // Event listeners
            document.getElementById('quickAddInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.trim()) {
                    quickAddTask(this.value.trim());
                    this.value = '';
                }
            });

            document.getElementById('searchInput').addEventListener('input', function() {
                searchTasks(this.value);
            });

            // Cerrar modal al hacer clic fuera
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
        });

        // Gesti√≥n de datos locales
        function saveData() {
            const data = {
                tasks: appData.tasks,
                projects: appData.projects,
                labels: appData.labels,
                taskIdCounter,
                projectIdCounter,
                labelIdCounter
            };
            // En lugar de localStorage, guardamos en una variable temporal
            window.appBackup = JSON.stringify(data);
        }

        function loadData() {
            try {
                if (window.appBackup) {
                    const data = JSON.parse(window.appBackup);
                    appData.tasks = data.tasks || [];
                    appData.projects = data.projects || appData.projects;
                    appData.labels = data.labels || appData.labels;
                    taskIdCounter = data.taskIdCounter || 1;
                    projectIdCounter = data.projectIdCounter || 4;
                    labelIdCounter = data.labelIdCounter || 4;
                }
            } catch (e) {
                console.log('No hay datos guardados, usando datos por defecto');
            }
        }

        // Navegaci√≥n
        function switchView(view) {
            appData.currentView = view;
            
            // Actualizar navegaci√≥n activa
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            // Actualizar t√≠tulo
            const titles = {
                today: 'Hoy',
                upcoming: 'Pr√≥ximamente',
                inbox: 'Bandeja de entrada',
                important: 'Importante',
                assigned: 'Asignadas a m√≠'
            };
            
            document.getElementById('mainTitle').textContent = titles[view] || view;
            
            renderTasks();
        }

        function switchToProject(projectId) {
            appData.currentView = 'project';
            appData.selectedProject = projectId;
            
            // Actualizar navegaci√≥n activa
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-project="${projectId}"]`).classList.add('active');
            
            const project = appData.projects.find(p => p.id === projectId);
            document.getElementById('mainTitle').textContent = project.name;
            
            renderTasks();
        }

        // Gesti√≥n de tareas
        function quickAddTask(title) {
            const task = {
                id: taskIdCounter++,
                title: title,
                description: '',
                completed: false,
                priority: 4,
                dueDate: null,
                projectId: null,
                labels: [],
                subtasks: [],
                createdAt: new Date().toISOString()
            };
            
            appData.tasks.push(task);
            saveData();
            renderTasks();
            updateCounts();
        }

        function addTask() {
            const title = document.getElementById('taskTitleInput').value.trim();
            if (!title) return;
            
            const task = {
                id: appData.editingTask ? appData.editingTask.id : taskIdCounter++,
                title: title,
                description: document.getElementById('taskDescriptionInput').value.trim(),
                completed: false,
                priority: appData.currentTask.priority || 4,
                dueDate: appData.currentTask.dueDate || null,
                projectId: appData.currentTask.projectId || null,
                labels: appData.currentTask.labels || [],
                subtasks: appData.editingTask ? appData.editingTask.subtasks || [] : [],
                createdAt: appData.editingTask ? appData.editingTask.createdAt : new Date().toISOString()
            };
            
            if (appData.editingTask) {
                const index = appData.tasks.findIndex(t => t.id === appData.editingTask.id);
                appData.tasks[index] = task;
            } else {
                appData.tasks.push(task);
            }
            
            saveData();
            hideTaskForm();
            renderTasks();
            updateCounts();
        }

        function saveTask() {
            const title = document.getElementById('modalTaskTitle').value.trim();
            if (!title) return;
            
            const task = {
                id: appData.editingTask ? appData.editingTask.id : taskIdCounter++,
                title: title,
                description: document.getElementById('modalTaskDescription').value.trim(),
                completed: appData.editingTask ? appData.editingTask.completed : false,
                priority: parseInt(document.getElementById('modalTaskPriority').value),
                dueDate: document.getElementById('modalTaskDate').value || null,
                projectId: parseInt(document.getElementById('modalTaskProject').value) || null,
                labels: getCurrentTaskLabels(),
                subtasks: getCurrentSubtasks(),
                createdAt: appData.editingTask ? appData.editingTask.createdAt : new Date().toISOString(),
                completedAt: appData.editingTask ? appData.editingTask.completedAt : null
            };
            
            if (appData.editingTask) {
                const index = appData.tasks.findIndex(t => t.id === appData.editingTask.id);
                appData.tasks[index] = task;
            } else {
                appData.tasks.push(task);
            }
            
            saveData();
            hideTaskModal();
            renderTasks();
            updateCounts();
            
            showNotification(appData.editingTask ? '‚úÖ Tarea actualizada' : '‚úÖ Tarea creada');
        }

        function deleteTask(taskId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta tarea?')) {
                appData.tasks = appData.tasks.filter(task => task.id !== taskId);
                saveData();
                renderTasks();
                updateCounts();
            }
        }

        function toggleTask(taskId) {
            const task = appData.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                task.completedAt = task.completed ? new Date().toISOString() : null;
                saveData();
                renderTasks();
                updateCounts();
            }
        }

        function toggleSubtask(taskId, subtaskId) {
            const task = appData.tasks.find(t => t.id === taskId);
            if (task && task.subtasks) {
                const subtask = task.subtasks.find(s => s.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    saveData();
                    renderTasks();
                }
            }
        }

        function editTask(taskId) {
            const task = appData.tasks.find(t => t.id === taskId);
            if (task) {
                appData.editingTask = task;
                
                // Llenar el modal con los datos de la tarea
                document.getElementById('modalTaskTitle').value = task.title;
                document.getElementById('modalTaskDescription').value = task.description || '';
                document.getElementById('modalTaskProject').value = task.projectId || '';
                document.getElementById('modalTaskDate').value = task.dueDate || '';
                document.getElementById('modalTaskPriority').value = task.priority;
                
                // Cargar etiquetas
                loadTaskLabels(task.labels || []);
                
                // Cargar subtareas
                loadTaskSubtasks(task.subtasks || []);
                
                showTaskModal();
            }
        }

        // Funciones para manejar etiquetas en el modal
        function handleLabelInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const label = input.value.trim();
                
                if (label && !getCurrentTaskLabels().includes(label)) {
                    addTaskLabel(label);
                    input.value = '';
                }
            }
        }

        function addTaskLabel(label) {
            const selectedLabelsContainer = document.getElementById('selectedLabels');
            
            const labelElement = document.createElement('span');
            labelElement.className = 'selected-label';
            labelElement.innerHTML = `
                #${label}
                <button class="remove-label-btn" onclick="removeTaskLabel('${label}')" type="button">√ó</button>
            `;
            
            selectedLabelsContainer.appendChild(labelElement);
        }

        function removeTaskLabel(labelToRemove) {
            const selectedLabelsContainer = document.getElementById('selectedLabels');
            const labelElements = selectedLabelsContainer.querySelectorAll('.selected-label');
            
            labelElements.forEach(element => {
                if (element.textContent.trim().startsWith(`#${labelToRemove}`)) {
                    element.remove();
                }
            });
        }

        function getCurrentTaskLabels() {
            const selectedLabelsContainer = document.getElementById('selectedLabels');
            const labelElements = selectedLabelsContainer.querySelectorAll('.selected-label');
            
            return Array.from(labelElements).map(element => {
                const text = element.textContent.trim();
                return text.substring(1, text.length - 1); // Remover # al inicio y √ó al final
            });
        }

        function loadTaskLabels(labels) {
            const selectedLabelsContainer = document.getElementById('selectedLabels');
            selectedLabelsContainer.innerHTML = '';
            
            labels.forEach(label => {
                addTaskLabel(label);
            });
        }

        // Funciones para manejar subtareas en el modal
        let subtaskIdCounter = 1000;

        function handleSubtaskInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const subtaskTitle = input.value.trim();
                
                if (subtaskTitle) {
                    addSubtask(subtaskTitle);
                    input.value = '';
                }
            }
        }

        function addSubtask(title, completed = false, id = null) {
            const subtasksList = document.getElementById('modalSubtasksList');
            const subtaskId = id || subtaskIdCounter++;
            
            const subtaskElement = document.createElement('div');
            subtaskElement.className = 'subtask-editor-item';
            subtaskElement.setAttribute('data-subtask-id', subtaskId);
            subtaskElement.innerHTML = `
                <div class="subtask-editor-content">
                    <input type="checkbox" class="subtask-editor-checkbox" ${completed ? 'checked' : ''} onchange="toggleSubtaskInEditor(${subtaskId})">
                    <input type="text" class="subtask-editor-input" value="${title}" onblur="updateSubtaskTitle(${subtaskId}, this.value)">
                    <button class="remove-subtask-btn" onclick="removeSubtask(${subtaskId})" type="button">üóëÔ∏è</button>
                </div>
            `;
            
            subtasksList.appendChild(subtaskElement);
        }

        function removeSubtask(subtaskId) {
            const subtaskElement = document.querySelector(`[data-subtask-id="${subtaskId}"]`);
            if (subtaskElement) {
                subtaskElement.remove();
            }
        }

        function toggleSubtaskInEditor(subtaskId) {
            // La funcionalidad se maneja autom√°ticamente con el checkbox
        }

        function updateSubtaskTitle(subtaskId, newTitle) {
            // La actualizaci√≥n se maneja autom√°ticamente con el input
        }

        function getCurrentSubtasks() {
            const subtaskItems = document.querySelectorAll('.subtask-editor-item');
            return Array.from(subtaskItems).map(item => {
                const id = parseInt(item.getAttribute('data-subtask-id'));
                const checkbox = item.querySelector('.subtask-editor-checkbox');
                const input = item.querySelector('.subtask-editor-input');
                
                return {
                    id: id,
                    title: input.value.trim(),
                    completed: checkbox.checked
                };
            }).filter(subtask => subtask.title); // Solo subtareas con t√≠tulo
        }

        function loadTaskSubtasks(subtasks) {
            const subtasksList = document.getElementById('modalSubtasksList');
            subtasksList.innerHTML = '';
            
            subtasks.forEach(subtask => {
                addSubtask(subtask.title, subtask.completed, subtask.id);
                if (subtask.id >= subtaskIdCounter) {
                    subtaskIdCounter = subtask.id + 1;
                }
            });
        }

        // Gesti√≥n de proyectos
        function addProject() {
            const name = document.getElementById('projectNameInput').value.trim();
            if (!name) return;
            
            const project = {
                id: projectIdCounter++,
                name: name,
                color: document.getElementById('projectColorInput').value,
                taskCount: 0
            };
            
            appData.projects.push(project);
            saveData();
            hideProjectModal();
            renderProjects();
            updateProjectSelects();
            
            // Limpiar formulario
            document.getElementById('projectNameInput').value = '';
        }

        function deleteProject(projectId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este proyecto? Las tareas del proyecto no se eliminar√°n.')) {
                // Remover el proyecto de las tareas
                appData.tasks.forEach(task => {
                    if (task.projectId === projectId) {
                        task.projectId = null;
                    }
                });
                
                appData.projects = appData.projects.filter(p => p.id !== projectId);
                saveData();
                renderProjects();
                renderTasks();
                updateCounts();
                updateProjectSelects();
            }
        }

        // Renderizado
        function renderTasks() {
            const tasksList = document.getElementById('tasksList');
            const filteredTasks = getFilteredTasks();
            
            if (filteredTasks.length === 0) {
                tasksList.innerHTML = '';
                document.getElementById('emptyState').style.display = 'block';
                return;
            }
            
            document.getElementById('emptyState').style.display = 'none';
            
            tasksList.innerHTML = filteredTasks.map(task => {
                const project = appData.projects.find(p => p.id === task.projectId);
                const dueDateInfo = getDueDateInfo(task.dueDate);
                const priorityClass = `priority-${task.priority}`;
                
                return `
                    <div class="task-item ${task.completed ? 'completed' : ''}">
                        <div class="task-header">
                            <div class="task-checkbox ${task.completed ? 'completed' : ''}" onclick="toggleTask(${task.id})">
                                ${task.completed ? '‚úì' : ''}
                            </div>
                            <div class="task-content">
                                <div class="task-title ${task.completed ? 'completed' : ''}">${task.title}</div>
                                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                                <div class="task-meta">
                                    ${project ? `<div class="task-project">
                                        <div class="project-color" style="background-color: ${project.color}; width: 8px; height: 8px; border-radius: 50%; margin-right: 4px;"></div>
                                        ${project.name}
                                    </div>` : ''}
                                    ${task.dueDate ? `<div class="task-due-date ${dueDateInfo.class}">
                                        üìÖ ${dueDateInfo.text}
                                    </div>` : ''}
                                    ${task.priority < 4 ? `<div class="task-priority">
                                        <div class="priority-flag ${priorityClass}">üèÉ</div>
                                    </div>` : ''}
                                    ${task.labels && task.labels.length > 0 ? `<div class="task-labels">
                                        ${task.labels.map(label => `<span class="task-label">#${label}</span>`).join('')}
                                    </div>` : ''}
                                </div>
                                ${task.subtasks && task.subtasks.length > 0 ? `
                                    <div class="subtasks">
                                        ${task.subtasks.map(subtask => `
                                            <div class="subtask-item">
                                                <div class="subtask-checkbox ${subtask.completed ? 'completed' : ''}" onclick="toggleSubtask(${task.id}, ${subtask.id})">
                                                    ${subtask.completed ? '‚úì' : ''}
                                                </div>
                                                <div class="subtask-title ${subtask.completed ? 'completed' : ''}">${subtask.title}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="task-actions-menu">
                                <button class="action-btn" onclick="editTask(${task.id})" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button class="action-btn" onclick="deleteTask(${task.id})" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderProjects() {
            const projectsList = document.getElementById('projectsList');
            
            projectsList.innerHTML = appData.projects.map(project => `
                <div class="nav-item project-item" data-project="${project.id}" onclick="switchToProject(${project.id})">
                    <div class="project-color" style="background-color: ${project.color}"></div>
                    <div class="nav-item-text">${project.name}</div>
                    <div class="nav-item-count">${project.taskCount}</div>
                </div>
            `).join('');
            
            updateProjectSelects();
        }

        function renderLabels() {
            const labelsList = document.getElementById('labelsList');
            
            labelsList.innerHTML = appData.labels.map(label => `
                <div class="nav-item" onclick="searchTasks('#${label.name}')">
                    <div class="nav-item-icon">üè∑Ô∏è</div>
                    <div class="nav-item-text">#${label.name}</div>
                </div>
            `).join('');
        }

        function updateProjectSelects() {
            const selects = document.querySelectorAll('#modalTaskProject');
            selects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = `
                    <option value="">Sin proyecto</option>
                    ${appData.projects.map(project => 
                        `<option value="${project.id}">${project.name}</option>`
                    ).join('')}
                `;
                select.value = currentValue;
            });
        }

        // Filtrado de tareas
        function getFilteredTasks() {
            let filtered = [...appData.tasks];
            
            switch (appData.currentView) {
                case 'today':
                    const today = new Date().toISOString().split('T')[0];
                    filtered = filtered.filter(task => 
                        !task.completed && (
                            task.dueDate === today || 
                            (task.dueDate && new Date(task.dueDate) < new Date(today))
                        )
                    );
                    break;
                case 'upcoming':
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    filtered = filtered.filter(task => 
                        !task.completed && task.dueDate && new Date(task.dueDate) >= tomorrow
                    );
                    break;
                case 'inbox':
                    filtered = filtered.filter(task => !task.completed && !task.projectId);
                    break;
                case 'important':
                    filtered = filtered.filter(task => !task.completed && task.priority <= 2);
                    break;
                case 'assigned':
                    // Por simplicidad, mostramos todas las tareas no completadas
                    filtered = filtered.filter(task => !task.completed);
                    break;
                case 'project':
                    filtered = filtered.filter(task => task.projectId === appData.selectedProject);
                    break;
                default:
                    break;
            }
            
            // Ordenar por prioridad y fecha
            filtered.sort((a, b) => {
                if (a.completed && !b.completed) return 1;
                if (!a.completed && b.completed) return -1;
                if (a.priority !== b.priority) return a.priority - b.priority;
                if (a.dueDate && b.dueDate) return new Date(a.dueDate) - new Date(b.dueDate);
                if (a.dueDate && !b.dueDate) return -1;
                if (!a.dueDate && b.dueDate) return 1;
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            return filtered;
        }

        function searchTasks(query) {
            if (!query.trim()) {
                renderTasks();
                return;
            }
            
            const tasksList = document.getElementById('tasksList');
            const searchResults = appData.tasks.filter(task => 
                task.title.toLowerCase().includes(query.toLowerCase()) ||
                (task.description && task.description.toLowerCase().includes(query.toLowerCase())) ||
                (query.startsWith('#') && task.labels.some(label => 
                    label.toLowerCase().includes(query.slice(1).toLowerCase())
                ))
            );
            
            // Mostrar resultados de b√∫squeda
            if (searchResults.length === 0) {
                tasksList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <div class="empty-title">No se encontraron resultados</div>
                        <div class="empty-description">Intenta con otros t√©rminos de b√∫squeda</div>
                    </div>
                `;
                return;
            }
            
            // Usar el mismo renderizado pero con resultados filtrados
            const originalTasks = [...appData.tasks];
            appData.tasks = searchResults;
            renderTasks();
            appData.tasks = originalTasks;
        }

        // Actualizaci√≥n de contadores
        function updateCounts() {
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const counts = {
                today: appData.tasks.filter(t => 
                    !t.completed && (
                        t.dueDate === today || 
                        (t.dueDate && new Date(t.dueDate) < new Date(today))
                    )
                ).length,
                upcoming: appData.tasks.filter(t => 
                    !t.completed && t.dueDate && new Date(t.dueDate) >= tomorrow
                ).length,
                inbox: appData.tasks.filter(t => !t.completed && !t.projectId).length,
                important: appData.tasks.filter(t => !t.completed && t.priority <= 2).length,
                assigned: appData.tasks.filter(t => !t.completed).length
            };
            
            // Actualizar contadores en la UI
            Object.keys(counts).forEach(view => {
                const element = document.getElementById(`${view}Count`);
                if (element) {
                    element.textContent = counts[view];
                }
            });
            
            // Actualizar contadores de proyectos
            appData.projects.forEach(project => {
                project.taskCount = appData.tasks.filter(t => 
                    t.projectId === project.id && !t.completed
                ).length;
            });
            
            renderProjects();
        }

        // Utilidades
        function getDueDateInfo(dueDate) {
            if (!dueDate) return null;
            
            const today = new Date().toISOString().split('T')[0];
            const taskDate = new Date(dueDate);
            const todayDate = new Date(today);
            
            if (dueDate === today) {
                return { text: 'Hoy', class: 'due-today' };
            } else if (taskDate < todayDate) {
                const daysDiff = Math.floor((todayDate - taskDate) / (1000 * 60 * 60 * 24));
                return { text: `Vencido ${daysDiff} d√≠a${daysDiff > 1 ? 's' : ''}`, class: 'due-overdue' };
            } else {
                const daysDiff = Math.floor((taskDate - todayDate) / (1000 * 60 * 60 * 24));
                if (daysDiff === 1) {
                    return { text: 'Ma√±ana', class: 'due-future' };
                } else if (daysDiff <= 7) {
                    return { text: `En ${daysDiff} d√≠as`, class: 'due-future' };
                } else {
                    return { text: new Date(dueDate).toLocaleDateString(), class: 'due-future' };
                }
            }
        }

        // Gesti√≥n de formularios y modales
        function showQuickAdd() {
            document.getElementById('quickAddInput').focus();
        }

        function showTaskForm() {
            document.getElementById('taskForm').classList.add('active');
            document.getElementById('taskTitleInput').focus();
            appData.editingTask = null;
            appData.currentTask = {};
            
            // Resetear formulario
            document.getElementById('taskTitleInput').value = '';
            document.getElementById('taskDescriptionInput').value = '';
            resetTaskOptions();
        }

        function hideTaskForm() {
            document.getElementById('taskForm').classList.remove('active');
            appData.editingTask = null;
            appData.currentTask = {};
        }

        function showTaskModal() {
            document.getElementById('taskModal').classList.add('active');
            updateProjectSelects();
            
            if (!appData.editingTask) {
                // Limpiar formulario para nueva tarea
                document.getElementById('modalTaskTitle').value = '';
                document.getElementById('modalTaskDescription').value = '';
                document.getElementById('modalTaskProject').value = '';
                document.getElementById('modalTaskDate').value = '';
                document.getElementById('modalTaskPriority').value = '4';
            }
        }

        function hideTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
            appData.editingTask = null;
            
            // Limpiar etiquetas y subtareas
            document.getElementById('selectedLabels').innerHTML = '';
            document.getElementById('modalSubtasksList').innerHTML = '';
            document.getElementById('modalTaskLabels').value = '';
            document.getElementById('newSubtaskInput').value = '';
        }

        function showProjectModal() {
            document.getElementById('projectModal').classList.add('active');
            document.getElementById('projectNameInput').focus();
        }

        function hideProjectModal() {
            document.getElementById('projectModal').classList.remove('active');
        }

        function resetTaskOptions() {
            document.getElementById('dueDateText').textContent = 'Fecha l√≠mite';
            document.getElementById('projectText').textContent = 'Proyecto';
            document.getElementById('priorityText').textContent = 'Prioridad';
            
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        // Funciones de opciones de tarea (simplificadas para el ejemplo)
        function toggleDatePicker() {
            const dateInput = prompt('Fecha l√≠mite (YYYY-MM-DD):');
            if (dateInput) {
                appData.currentTask.dueDate = dateInput;
                document.getElementById('dueDateText').textContent = new Date(dateInput).toLocaleDateString();
                document.querySelector('[onclick="toggleDatePicker()"]').classList.add('active');
            }
        }

        function toggleProjectPicker() {
            const projectSelect = document.createElement('select');
            projectSelect.innerHTML = `
                <option value="">Sin proyecto</option>
                ${appData.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
            `;
            
            const projectName = prompt('Seleccionar proyecto:\n' + appData.projects.map((p, i) => `${i + 1}. ${p.name}`).join('\n') + '\n\nEscribe el n√∫mero:');
            if (projectName) {
                const projectIndex = parseInt(projectName) - 1;
                if (projectIndex >= 0 && projectIndex < appData.projects.length) {
                    const project = appData.projects[projectIndex];
                    appData.currentTask.projectId = project.id;
                    document.getElementById('projectText').textContent = project.name;
                    document.querySelector('[onclick="toggleProjectPicker()"]').classList.add('active');
                }
            }
        }

        function togglePriorityPicker() {
            const priorities = ['Alta (1)', 'Media (2)', 'Normal (3)', 'Baja (4)'];
            const priorityChoice = prompt('Seleccionar prioridad:\n' + priorities.map((p, i) => `${i + 1}. ${p}`).join('\n') + '\n\nEscribe el n√∫mero:');
            if (priorityChoice) {
                const priority = parseInt(priorityChoice);
                if (priority >= 1 && priority <= 4) {
                    appData.currentTask.priority = priority;
                    document.getElementById('priorityText').textContent = `Prioridad ${priority}`;
                    document.querySelector('[onclick="togglePriorityPicker()"]').classList.add('active');
                }
            }
        }

        function toggleLabelPicker() {
            const label = prompt('A√±adir etiqueta:');
            if (label) {
                if (!appData.currentTask.labels) appData.currentTask.labels = [];
                appData.currentTask.labels.push(label);
                document.querySelector('[onclick="toggleLabelPicker()"]').classList.add('active');
            }
        }

        // Responsive
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Cerrar sidebar en mobile al hacer clic en el contenido
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                if (!e.target.closest('.sidebar') && !e.target.closest('.mobile-menu-btn')) {
                    document.getElementById('sidebar').classList.remove('open');
                }
            }
        });

        // Datos de ejemplo
        function loadSampleData() {
            const sampleTasks = [
                {
                    id: taskIdCounter++,
                    title: 'Completar presentaci√≥n para el cliente',
                    description: 'Preparar slides y ensayar presentaci√≥n',
                    completed: false,
                    priority: 1,
                    dueDate: new Date().toISOString().split('T')[0],
                    projectId: 1,
                    labels: ['urgente', 'presentaci√≥n'],
                    subtasks: [],
                    createdAt: new Date().toISOString()
                },
                {
                    id: taskIdCounter++,
                    title: 'Comprar ingredientes para la cena',
                    description: '',
                    completed: false,
                    priority: 3,
                    dueDate: new Date().toISOString().split('T')[0],
                    projectId: 2,
                    labels: ['compras'],
                    subtasks: [
                        { id: 1, title: 'Tomates', completed: false },
                        { id: 2, title: 'Pasta', completed: true },
                        { id: 3, title: 'Queso', completed: false }
                    ],
                    createdAt: new Date().toISOString()
                },
                {
                    id: taskIdCounter++,
                    title: 'Revisar documentaci√≥n del proyecto',
                    description: 'Leer y comentar los documentos t√©cnicos',
                    completed: true,
                    priority: 2,
                    dueDate: null,
                    projectId: 1,
                    labels: ['revision'],
                    subtasks: [],
                    createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()
                }
            ];
            
            appData.tasks = sampleTasks;
            saveData();
            renderTasks();
            updateCounts();
        }

        // Cargar datos de ejemplo al inicio si no hay datos
        if (appData.tasks.length === 0) {
            loadSampleData();
        }

        // Funcionalidades adicionales avanzadas
        
        // Sistema de notificaciones
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                    <span class="notification-message">${message}</span>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove despu√©s de 5 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
            
            // Animaci√≥n de entrada
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
        }

        // Drag and Drop para reordenar tareas
        let draggedTask = null;

        function enableDragAndDrop() {
            const taskItems = document.querySelectorAll('.task-item');
            
            taskItems.forEach(task => {
                task.draggable = true;
                
                task.addEventListener('dragstart', function(e) {
                    draggedTask = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                task.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    draggedTask = null;
                });
                
                task.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    const afterElement = getDragAfterElement(this.parentElement, e.clientY);
                    if (afterElement == null) {
                        this.parentElement.appendChild(draggedTask);
                    } else {
                        this.parentElement.insertBefore(draggedTask, afterElement);
                    }
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Shortcuts de teclado
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + N: Nueva tarea
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                showTaskModal();
            }
            
            // Ctrl/Cmd + F: Buscar
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
            
            // Escape: Cerrar modales
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    modal.classList.remove('active');
                });
                hideTaskForm();
            }
            
            // Enter: Confirmar acciones en modales
            if (e.key === 'Enter' && document.querySelector('.modal.active')) {
                const activeModal = document.querySelector('.modal.active');
                if (activeModal.id === 'taskModal') {
                    saveTask();
                } else if (activeModal.id === 'projectModal') {
                    addProject();
                }
            }
        });

        // Estad√≠sticas y productividad
        function getProductivityStats() {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            const completedTasks = appData.tasks.filter(t => t.completed);
            
            const stats = {
                totalTasks: appData.tasks.length,
                completedTasks: completedTasks.length,
                completionRate: Math.round((completedTasks.length / appData.tasks.length) * 100) || 0,
                completedThisWeek: completedTasks.filter(t => 
                    t.completedAt && new Date(t.completedAt) >= weekAgo
                ).length,
                completedThisMonth: completedTasks.filter(t => 
                    t.completedAt && new Date(t.completedAt) >= monthAgo
                ).length,
                highPriorityCompleted: completedTasks.filter(t => t.priority <= 2).length,
                averageCompletionTime: calculateAverageCompletionTime(),
                mostProductiveDay: getMostProductiveDay(),
                projectStats: getProjectStats()
            };
            
            return stats;
        }

        function calculateAverageCompletionTime() {
            const completedTasks = appData.tasks.filter(t => t.completed && t.completedAt);
            if (completedTasks.length === 0) return 0;
            
            const totalTime = completedTasks.reduce((sum, task) => {
                const created = new Date(task.createdAt);
                const completed = new Date(task.completedAt);
                return sum + (completed - created);
            }, 0);
            
            return Math.round(totalTime / completedTasks.length / (1000 * 60 * 60 * 24)); // d√≠as
        }

        function getMostProductiveDay() {
            const dayStats = {};
            const completedTasks = appData.tasks.filter(t => t.completed && t.completedAt);
            
            completedTasks.forEach(task => {
                const day = new Date(task.completedAt).toLocaleDateString('es-ES', { weekday: 'long' });
                dayStats[day] = (dayStats[day] || 0) + 1;
            });
            
            let mostProductiveDay = 'Sin datos';
            let maxTasks = 0;
            
            Object.entries(dayStats).forEach(([day, count]) => {
                if (count > maxTasks) {
                    maxTasks = count;
                    mostProductiveDay = day;
                }
            });
            
            return mostProductiveDay;
        }

        function getProjectStats() {
            return appData.projects.map(project => {
                const projectTasks = appData.tasks.filter(t => t.projectId === project.id);
                const completedTasks = projectTasks.filter(t => t.completed);
                
                return {
                    name: project.name,
                    color: project.color,
                    totalTasks: projectTasks.length,
                    completedTasks: completedTasks.length,
                    completionRate: Math.round((completedTasks.length / projectTasks.length) * 100) || 0
                };
            });
        }

        // Modal de estad√≠sticas
        function showStatsModal() {
            const stats = getProductivityStats();
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'statsModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2 class="modal-title">üìä Estad√≠sticas de productividad</h2>
                        <button class="modal-close" onclick="hideStatsModal()">√ó</button>
                    </div>
                    
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-number">${stats.totalTasks}</div>
                            <div class="stat-label">Tareas totales</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.completedTasks}</div>
                            <div class="stat-label">Tareas completadas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.completionRate}%</div>
                            <div class="stat-label">Tasa de finalizaci√≥n</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.completedThisWeek}</div>
                            <div class="stat-label">Completadas esta semana</div>
                        </div>
                    </div>
                    
                    <div class="stats-details" style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 16px; color: #333;">üìà Detalles de productividad</h3>
                        <div class="detail-grid" style="display: grid; gap: 12px;">
                            <div class="detail-item">
                                <span class="detail-label">Completadas este mes:</span>
                                <span class="detail-value">${stats.completedThisMonth}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Alta prioridad completadas:</span>
                                <span class="detail-value">${stats.highPriorityCompleted}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Tiempo promedio de finalizaci√≥n:</span>
                                <span class="detail-value">${stats.averageCompletionTime} d√≠as</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">D√≠a m√°s productivo:</span>
                                <span class="detail-value">${stats.mostProductiveDay}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="project-stats">
                        <h3 style="margin-bottom: 16px; color: #333;">üìÅ Estad√≠sticas por proyecto</h3>
                        <div class="project-stats-list">
                            ${stats.projectStats.map(project => `
                                <div class="project-stat-item" style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 8px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div class="project-color" style="background-color: ${project.color}; width: 12px; height: 12px; border-radius: 50%;"></div>
                                        <span style="font-weight: 500;">${project.name}</span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 14px; font-weight: 600;">${project.completedTasks}/${project.totalTasks}</div>
                                        <div style="font-size: 12px; color: #666;">${project.completionRate}% completado</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 24px;">
                        <button class="btn btn-secondary" onclick="exportData()" style="margin-right: 12px;">üì• Exportar datos</button>
                        <button class="btn btn-primary" onclick="hideStatsModal()">Cerrar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function hideStatsModal() {
            const modal = document.getElementById('statsModal');
            if (modal) {
                modal.remove();
            }
        }

        // Exportar/Importar datos
        function exportData() {
            const dataToExport = {
                tasks: appData.tasks,
                projects: appData.projects,
                labels: appData.labels,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `todoist-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('‚úÖ Datos exportados correctamente');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (importedData.tasks && importedData.projects) {
                            if (confirm('¬øEst√°s seguro de que quieres importar estos datos? Esto reemplazar√° todos los datos actuales.')) {
                                appData.tasks = importedData.tasks || [];
                                appData.projects = importedData.projects || [];
                                appData.labels = importedData.labels || [];
                                
                                // Actualizar contadores
                                taskIdCounter = Math.max(...appData.tasks.map(t => t.id), 0) + 1;
                                projectIdCounter = Math.max(...appData.projects.map(p => p.id), 0) + 1;
                                labelIdCounter = Math.max(...appData.labels.map(l => l.id), 0) + 1;
                                
                                saveData();
                                renderProjects();
                                renderLabels();
                                renderTasks();
                                updateCounts();
                                
                                showNotification('‚úÖ Datos importados correctamente');
                            }
                        } else {
                            showNotification('‚ùå Archivo de respaldo inv√°lido', 'error');
                        }
                    } catch (error) {
                        showNotification('‚ùå Error al importar datos: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Modo oscuro
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            window.darkModeEnabled = isDark;
            
            showNotification(isDark ? 'üåô Modo oscuro activado' : '‚òÄÔ∏è Modo claro activado');
        }

        // Agregar estilos para el modo oscuro y las estad√≠sticas
        const additionalStyles = `
            .dark-mode {
                background-color: #1a1a1a;
                color: #e0e0e0;
            }
            
            .dark-mode .sidebar,
            .dark-mode .main-header,
            .dark-mode .task-item,
            .dark-mode .task-form,
            .dark-mode .modal-content {
                background-color: #2d2d2d;
                border-color: #404040;
                color: #e0e0e0;
            }
            
            .dark-mode .search-input,
            .dark-mode .task-input,
            .dark-mode .form-input {
                background-color: #404040;
                border-color: #555;
                color: #e0e0e0;
            }
            
            .dark-mode .nav-item:hover {
                background-color: #404040;
            }
            
            .dark-mode .quick-add {
                background-color: #2d2d2d;
                border-color: #404040;
            }
            
            .stat-card {
                background-color: #f8f9fa;
                padding: 20px;
                border-radius: 12px;
                text-align: center;
                border: 1px solid #e9ecef;
            }
            
            .dark-mode .stat-card {
                background-color: #404040;
                border-color: #555;
                color: #e0e0e0;
            }
            
            .stat-number {
                font-size: 32px;
                font-weight: 700;
                color: #db4035;
                margin-bottom: 8px;
            }
            
            .stat-label {
                font-size: 14px;
                color: #666;
                font-weight: 500;
            }
            
            .dark-mode .stat-label {
                color: #bbb;
            }
            
            .detail-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 12px;
                background-color: #f8f9fa;
                border-radius: 6px;
            }
            
            .dark-mode .detail-item {
                background-color: #404040;
            }
            
            .detail-label {
                font-size: 14px;
                color: #666;
            }
            
            .dark-mode .detail-label {
                color: #bbb;
            }
            
            .detail-value {
                font-weight: 600;
                color: #333;
            }
            
            .dark-mode .detail-value {
                color: #e0e0e0;
            }
            
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #fff;
                border: 1px solid #e1e1e1;
                border-radius: 8px;
                padding: 16px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                max-width: 400px;
                transform: translateX(400px);
                transition: transform 0.3s ease;
            }
            
            .notification.show {
                transform: translateX(0);
            }
            
            .notification-success {
                border-left: 4px solid #10b981;
            }
            
            .notification-error {
                border-left: 4px solid #ef4444;
            }
            
            .notification-content {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .notification-icon {
                font-size: 16px;
            }
            
            .notification-message {
                font-size: 14px;
                font-weight: 500;
            }
            
            .notification-close {
                background: none;
                border: none;
                font-size: 18px;
                cursor: pointer;
                color: #666;
                margin-left: auto;
                padding: 0 4px;
            }
            
            .task-item.dragging {
                opacity: 0.5;
                transform: rotate(5deg);
            }
            
            .task-item[draggable="true"]:hover {
                cursor: move;
            }
            
            /* Estilos para etiquetas en el modal */
            .labels-input-container {
                position: relative;
            }
            
            .selected-labels {
                display: flex;
                gap: 6px;
                flex-wrap: wrap;
                margin-top: 8px;
            }
            
            .selected-label {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                background-color: #f3f4f6;
                color: #374151;
                font-size: 12px;
                padding: 4px 8px;
                border-radius: 4px;
                border: 1px solid #d1d5db;
            }
            
            .dark-mode .selected-label {
                background-color: #404040;
                color: #e0e0e0;
                border-color: #555;
            }
            
            .remove-label-btn {
                background: none;
                border: none;
                color: #6b7280;
                cursor: pointer;
                font-size: 14px;
                line-height: 1;
                padding: 0;
                margin-left: 4px;
            }
            
            .remove-label-btn:hover {
                color: #ef4444;
            }
            
            /* Estilos para subtareas en el modal */
            .subtasks-editor {
                border: 1px solid #e1e1e1;
                border-radius: 6px;
                padding: 12px;
                background-color: #f9f9f9;
            }
            
            .dark-mode .subtasks-editor {
                background-color: #404040;
                border-color: #555;
            }
            
            .subtasks-list {
                display: flex;
                flex-direction: column;
                gap: 8px;
                margin-bottom: 12px;
            }
            
            .subtask-editor-item {
                background-color: #fff;
                border: 1px solid #e1e1e1;
                border-radius: 4px;
                padding: 8px;
            }
            
            .dark-mode .subtask-editor-item {
                background-color: #2d2d2d;
                border-color: #555;
            }
            
            .subtask-editor-content {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .subtask-editor-checkbox {
                width: 16px;
                height: 16px;
                cursor: pointer;
            }
            
            .subtask-editor-input {
                flex: 1;
                border: none;
                background: transparent;
                font-size: 14px;
                padding: 4px;
                border-radius: 3px;
            }
            
            .subtask-editor-input:focus {
                outline: none;
                background-color: #f8f9fa;
            }
            
            .dark-mode .subtask-editor-input {
                color: #e0e0e0;
            }
            
            .dark-mode .subtask-editor-input:focus {
                background-color: #404040;
            }
            
            .remove-subtask-btn {
                background: none;
                border: none;
                cursor: pointer;
                font-size: 14px;
                padding: 4px;
                border-radius: 3px;
                opacity: 0.6;
                transition: opacity 0.2s;
            }
            
            .remove-subtask-btn:hover {
                opacity: 1;
                background-color: #fef2f2;
            }
            
            .dark-mode .remove-subtask-btn:hover {
                background-color: #553c3c;
            }
            
            .add-subtask-container {
                border-top: 1px solid #e1e1e1;
                padding-top: 8px;
            }
            
            .dark-mode .add-subtask-container {
                border-top-color: #555;
            }
        `;
        
        // Agregar estilos adicionales
        const styleSheet = document.createElement('style');
        styleSheet.textContent = additionalStyles;
        document.head.appendChild(styleSheet);

        // Agregar botones adicionales a la interfaz
        function addAdvancedFeatures() {
            // Agregar bot√≥n de estad√≠sticas al header
            const headerActions = document.querySelector('.header-actions');
            const statsBtn = document.createElement('button');
            statsBtn.className = 'header-btn';
            statsBtn.onclick = showStatsModal;
            statsBtn.innerHTML = '<span>üìä</span> Estad√≠sticas';
            headerActions.insertBefore(statsBtn, headerActions.firstChild);
            
            // Agregar bot√≥n de modo oscuro
            const darkModeBtn = document.createElement('button');
            darkModeBtn.className = 'header-btn';
            darkModeBtn.onclick = toggleDarkMode;
            darkModeBtn.innerHTML = '<span>üåô</span> Tema';
            headerActions.insertBefore(darkModeBtn, headerActions.firstChild);
            
            // Agregar opciones de importar/exportar al sidebar
            const sidebarNav = document.querySelector('.sidebar-nav');
            const dataSection = document.createElement('div');
            dataSection.className = 'nav-section';
            dataSection.innerHTML = `
                <div class="nav-section-title">Datos</div>
                <div class="nav-item" onclick="exportData()">
                    <div class="nav-item-icon">üì•</div>
                    <div class="nav-item-text">Exportar</div>
                </div>
                <div class="nav-item" onclick="importData()">
                    <div class="nav-item-icon">üì§</div>
                    <div class="nav-item-text">Importar</div>
                </div>
            `;
            sidebarNav.appendChild(dataSection);
        }
        
        // Inicializar funciones avanzadas
        setTimeout(() => {
            addAdvancedFeatures();
            
            // Re-renderizar con drag and drop
            const originalRenderTasks = renderTasks;
            renderTasks = function() {
                originalRenderTasks();
                setTimeout(() => enableDragAndDrop(), 100);
            };
            
            renderTasks();
        }, 1000);

        // Auto-guardado cada 30 segundos
        setInterval(() => {
            saveData();
        }, 30000);

        // Mostrar mensaje de bienvenida
        setTimeout(() => {
            showNotification('üéâ ¬°Bienvenido a tu gestor de tareas! Usa Ctrl+N para crear una nueva tarea.');
        }, 2000);
    </script>
</body>
</html>
